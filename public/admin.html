<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatery Dashboard - WhatsApp API</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/assets/admin.css" rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-text">Chatery<span>API</span></div>
        </div>
        <div class="header-actions">
            <div class="status-badge">
                <div class="status-dot" id="wsStatus"></div>
                <span id="wsStatusText">WebSocket Disconnected</span>
            </div>
            <a href="/ws-test" class="btn btn-outline btn-sm">WebSocket Tester</a>
            <button onclick="logout()" class="btn btn-danger btn-sm">üö™ Logout</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Total Sessions</div>
                <div class="stat-value info" id="statSessions">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Connected</div>
                <div class="stat-value success" id="statConnected">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Disconnected</div>
                <div class="stat-value danger" id="statDisconnected">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">WebSocket Clients</div>
                <div class="stat-value warning" id="statWsClients">0</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Left Column -->
            <div>
                <!-- Sessions Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üì± Sessions</div>
                        <button class="btn btn-primary btn-sm" onclick="createSession()">
                            + New Session
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="sessionsList" class="session-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">üì±</div>
                                <p>No sessions yet</p>
                                <p style="font-size: 13px; margin-top: 8px;">Create a new session to get started</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Tester -->
                <div class="card api-tester">
                    <div class="card-header">
                        <div class="card-title">üß™ API Tester</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Endpoint</label>
                            <select class="endpoint-select" id="apiEndpoint" onchange="updateRequestBody()">
                                <optgroup label="Sessions">
                                    <option value="GET|/api/whatsapp/sessions">GET /sessions - List all sessions
                                    </option>
                                    <option value="GET|/api/whatsapp/sessions/{sessionId}/status">GET
                                        /sessions/:sessionId/status - Get session status</option>
                                    <option value="GET|/api/whatsapp/sessions/{sessionId}/qr">GET
                                        /sessions/:sessionId/qr - Get QR code (JSON)</option>
                                    <option value="GET|/api/whatsapp/sessions/{sessionId}/qr/image">GET
                                        /sessions/:sessionId/qr/image - Get QR code (PNG Image)</option>
                                    <option value="POST|/api/whatsapp/sessions/{sessionId}/connect">POST
                                        /sessions/:sessionId/connect - Connect session</option>
                                    <option value="PATCH|/api/whatsapp/sessions/{sessionId}/config">PATCH
                                        /sessions/:sessionId/config - Update config</option>
                                    <option value="POST|/api/whatsapp/sessions/{sessionId}/webhooks">POST
                                        /sessions/:sessionId/webhooks - Add webhook</option>
                                    <option value="DELETE|/api/whatsapp/sessions/{sessionId}/webhooks">DELETE
                                        /sessions/:sessionId/webhooks - Remove webhook</option>
                                    <option value="DELETE|/api/whatsapp/sessions/{sessionId}">DELETE
                                        /sessions/:sessionId - Delete session</option>
                                </optgroup>
                                <optgroup label="Messaging">
                                    <option value="POST|/api/whatsapp/chats/send-text">POST /chats/send-text - Send text
                                        message</option>
                                    <option value="POST|/api/whatsapp/chats/send-image">POST /chats/send-image - Send
                                        image</option>
                                    <option value="POST|/api/whatsapp/chats/send-document">POST /chats/send-document -
                                        Send document</option>
                                    <option value="POST|/api/whatsapp/chats/send-audio">POST /chats/send-audio - Send
                                        audio/voice note</option>
                                    <option value="POST|/api/whatsapp/chats/send-location">POST /chats/send-location -
                                        Send location</option>
                                    <option value="POST|/api/whatsapp/chats/send-contact">POST /chats/send-contact -
                                        Send contact</option>
                                    <option value="POST|/api/whatsapp/chats/send-poll">POST /chats/send-poll - Send
                                        poll message</option>
                                    <option value="POST|/api/whatsapp/chats/send-button">POST /chats/send-button - Send
                                        button (‚ö†Ô∏è deprecated, uses Poll)</option>
                                    <option value="POST|/api/whatsapp/chats/presence">POST /chats/presence - Send typing
                                        indicator</option>
                                    <option value="POST|/api/whatsapp/chats/check-number">POST /chats/check-number -
                                        Check number exists</option>
                                    <option value="POST|/api/whatsapp/chats/profile-picture">POST /chats/profile-picture
                                        - Get profile picture</option>
                                </optgroup>
                                <optgroup label="Bulk Messaging">
                                    <option value="POST|/api/whatsapp/chats/send-bulk">POST /chats/send-bulk - Send bulk
                                        text (Background)</option>
                                    <option value="POST|/api/whatsapp/chats/send-bulk-image">POST /chats/send-bulk-image
                                        - Send bulk image (Background)</option>
                                    <option value="POST|/api/whatsapp/chats/send-bulk-document">POST
                                        /chats/send-bulk-document - Send bulk document (Background)</option>
                                    <option value="GET|/api/whatsapp/chats/bulk-status/{jobId}">GET
                                        /chats/bulk-status/:jobId - Get job status</option>
                                    <option value="POST|/api/whatsapp/chats/bulk-jobs">POST /chats/bulk-jobs - Get all
                                        bulk jobs</option>
                                </optgroup>
                                <optgroup label="Chat History">
                                    <option value="POST|/api/whatsapp/chats/overview">POST /chats/overview - Get chats
                                        overview</option>
                                    <option value="POST|/api/whatsapp/contacts">POST /contacts - Get contacts</option>
                                    <option value="POST|/api/whatsapp/chats/messages">POST /chats/messages - Get chat
                                        messages</option>
                                    <option value="POST|/api/whatsapp/chats/info">POST /chats/info - Get chat info
                                    </option>
                                    <option value="POST|/api/whatsapp/chats/mark-read">POST /chats/mark-read - Mark chat
                                        as read</option>
                                </optgroup>
                                <optgroup label="Groups - Basic">
                                    <option value="POST|/api/whatsapp/groups">POST /groups - Get all groups</option>
                                    <option value="POST|/api/whatsapp/groups/create">POST /groups/create - Create new
                                        group</option>
                                    <option value="POST|/api/whatsapp/groups/metadata">POST /groups/metadata - Get group
                                        metadata</option>
                                    <option value="POST|/api/whatsapp/groups/leave">POST /groups/leave - Leave group
                                    </option>
                                    <option value="POST|/api/whatsapp/groups/join">POST /groups/join - Join via invite
                                        code</option>
                                </optgroup>
                                <optgroup label="Groups - Participants">
                                    <option value="POST|/api/whatsapp/groups/participants/add">POST
                                        /groups/participants/add - Add participants</option>
                                    <option value="POST|/api/whatsapp/groups/participants/remove">POST
                                        /groups/participants/remove - Remove participants</option>
                                    <option value="POST|/api/whatsapp/groups/participants/promote">POST
                                        /groups/participants/promote - Promote to admin</option>
                                    <option value="POST|/api/whatsapp/groups/participants/demote">POST
                                        /groups/participants/demote - Demote from admin</option>
                                </optgroup>
                                <optgroup label="Groups - Settings">
                                    <option value="POST|/api/whatsapp/groups/subject">POST /groups/subject - Update
                                        group name</option>
                                    <option value="POST|/api/whatsapp/groups/description">POST /groups/description -
                                        Update description</option>
                                    <option value="POST|/api/whatsapp/groups/settings">POST /groups/settings - Update
                                        settings</option>
                                    <option value="POST|/api/whatsapp/groups/picture">POST /groups/picture - Update
                                        picture</option>
                                    <option value="POST|/api/whatsapp/groups/invite-code">POST /groups/invite-code - Get
                                        invite link</option>
                                    <option value="POST|/api/whatsapp/groups/revoke-invite">POST /groups/revoke-invite -
                                        Revoke invite link</option>
                                </optgroup>
                                <optgroup label="WebSocket">
                                    <option value="GET|/api/websocket/stats">GET /websocket/stats - WebSocket stats
                                    </option>
                                </optgroup>
                                <optgroup label="System">
                                    <option value="GET|/api/health">GET /health - Health check</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group" id="sessionIdGroup" style="display: none;">
                            <label class="form-label">Session ID (for URL)</label>
                            <input type="text" class="form-input" id="apiSessionId" placeholder="Enter session ID">
                        </div>
                        <div class="form-group" id="jobIdGroup" style="display: none;">
                            <label class="form-label">Job ID (for URL)</label>
                            <input type="text" class="form-input" id="apiJobId"
                                placeholder="Enter job ID (e.g., bulk_123456789_abc123def)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Request Body (JSON)</label>
                            <textarea class="json-editor" id="apiBody" placeholder="{}"></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="sendApiRequest()" id="btnSendApi">
                            Send Request
                        </button>
                        <div class="api-help" id="apiHelp" style="display: none;"></div>
                        <div class="form-group" style="margin-top: 16px;">
                            <label class="form-label">Response</label>
                            <div class="response-box" id="apiResponse">Response will appear here...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Events Log -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üì° Live Events</div>
                        <button class="btn btn-outline btn-sm" onclick="clearEvents()">Clear</button>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div class="events-log" id="eventsLog">
                            <div class="empty-state">
                                <div class="empty-state-icon">üì°</div>
                                <p>No events yet</p>
                                <p style="font-size: 13px; margin-top: 8px;">Events will appear here in real-time</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Send -->
                <div class="card" style="margin-top: 24px;">
                    <div class="card-header">
                        <div class="card-title">‚úâÔ∏è Quick Send</div>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Session</label>
                            <select class="form-input" id="quickSession">
                                <option value="">Select session...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="text" class="form-input" id="quickPhone" placeholder="628123456789">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message</label>
                            <textarea class="form-input" id="quickMessage" rows="3"
                                placeholder="Type your message..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="quickSend()" style="width: 100%;">
                            Send Message
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-buttons">
                <a href="https://saweria.co/fajrichan" target="_blank" class="btn btn-donate">
                    ‚òï Buy Me a Coffee
                </a>
                <a href="https://github.com/farinchan/chatery_whatsapp" target="_blank" class="btn btn-github">
                    ‚≠ê Star on GitHub
                </a>
                <a href="https://www.linkedin.com/in/fajri-chan" target="_blank" class="btn btn-outline">
                    üíº LinkedIn
                </a>
            </div>
            <div class="footer-credit">
                Made with ‚ù§Ô∏è by <a href="https://github.com/farinchan" target="_blank">Farin Chan</a> |
                <strong>Chatery API</strong> - WhatsApp Multi-Session Gateway
            </div>
            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">
                üìä <strong>Fitur:</strong> Text, Image, Document, Audio, Location, Contact, Poll, Bulk Messaging, Reply Messages
            </div>
            <div style="font-size: 12px; color: var(--text-muted);">
                ¬© <span id="footerYear"></span> Chatery. Open Source under MIT License.

            </div>
        </div>
    </footer>

    <!-- QR Modal -->
    <div class="modal-overlay" id="qrModal">
        <div class="modal">
            <div class="modal-title">üì± Scan QR Code</div>
            <div class="modal-subtitle" id="qrSessionName">Session: -</div>
            <div class="qr-container" id="qrContainer">
                <div class="qr-loading">
                    <div class="spinner"></div>
                </div>
            </div>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
                Open WhatsApp on your phone ‚Üí Menu ‚Üí Linked Devices ‚Üí Link a Device
            </p>
            <button class="btn btn-outline" onclick="closeQrModal()">Close</button>
        </div>
    </div>

    <!-- Webhooks Modal -->
    <div class="modal-overlay" id="webhooksModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-title">üîó Manage Webhooks</div>
            <div class="modal-subtitle" id="webhooksSessionName">Session: -</div>

            <!-- Add Webhook Form -->
            <div
                style="background: var(--card-bg); border-radius: 8px; padding: 16px; margin-bottom: 16px; text-align: left;">
                <div class="form-group" style="margin-bottom: 12px;">
                    <label class="form-label">Webhook URL</label>
                    <input type="url" class="form-input" id="newWebhookUrl"
                        placeholder="https://your-server.com/webhook">
                </div>
                <div class="form-group" style="margin-bottom: 12px;">
                    <label class="form-label">Events (optional - leave empty for all events)</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="message"> message
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="message_ack"> message_ack
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="message_revoke"> message_revoke
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="presence"> presence
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="qr"> qr
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="ready"> ready
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="disconnected"> disconnected
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="group_update"> group_update
                        </label>
                        <label
                            style="display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted);">
                            <input type="checkbox" class="webhook-event" value="group_participants"> group_participants
                        </label>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addWebhook()" style="width: 100%;">‚ûï Add Webhook</button>
            </div>

            <!-- Existing Webhooks List -->
            <div style="text-align: left;">
                <label class="form-label">Active Webhooks</label>
                <div id="webhooksList" style="max-height: 200px; overflow-y: auto;">
                    <div style="text-align: center; color: var(--text-muted); padding: 16px;">Loading...</div>
                </div>
            </div>

            <div style="margin-top: 16px;">
                <button class="btn btn-outline" onclick="closeWebhooksModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>
    <script src="/assets/admin.js"></script>
</body>

</html>