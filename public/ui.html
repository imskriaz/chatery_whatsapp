<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Web</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        :root {
            --whatsapp-green: #00a884;
            --whatsapp-dark-green: #008069;
            --whatsapp-bg: #111b21;
            --whatsapp-panel: #202c33;
            --whatsapp-chat-bg: #0c1317;
            --whatsapp-message-out: #005c4b;
            --whatsapp-message-in: #202c33;
            --whatsapp-border: #2a3942;
            --whatsapp-text: #e9edef;
            --whatsapp-text-secondary: #8696a0;
            --whatsapp-text-tertiary: #667781;
            --whatsapp-blue: #53bdeb;
            --whatsapp-hover: #2a3942;
        }
        
        body {
            background-color: var(--whatsapp-bg);
            color: var(--whatsapp-text);
            height: 100vh;
            overflow: hidden;
        }
        
        .whatsapp-bg {
            background: linear-gradient(180deg, var(--whatsapp-green) 0%, var(--whatsapp-green) 127px, var(--whatsapp-bg) 127px, var(--whatsapp-bg) 100%);
            height: 100vh;
        }
        
        .whatsapp-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .whatsapp-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .whatsapp-scrollbar::-webkit-scrollbar-thumb {
            background: var(--whatsapp-border);
            border-radius: 3px;
        }
        
        .whatsapp-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--whatsapp-text-secondary);
        }
        
        .message-in {
            background-color: var(--whatsapp-message-in);
            border-radius: 7.5px;
            border-top-left-radius: 0;
        }
        
        .message-out {
            background-color: var(--whatsapp-message-out);
            border-radius: 7.5px;
            border-top-right-radius: 0;
        }
        
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }
        
        .date-separator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--whatsapp-border);
            z-index: 0;
        }
        
        .chat-bg-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23202c33' fill-opacity='0.03'%3E%3Cpath d='M50 50c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10zM10 10c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c0 5.523-4.477 10-10 10S0 25.523 0 20s4.477-10 10-10zm10 8c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm40 40c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z' /%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 4px;
        }
        
        .context-menu-shadow {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2), 0 8px 16px rgba(0, 0, 0, 0.24);
        }
        
        .modal-overlay-bg {
            background: rgba(11, 20, 26, 0.85);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .status-pulse {
            animation: pulse 2s infinite;
        }
        
        .selected-message {
            background-color: rgba(0, 168, 132, 0.1) !important;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slideIn {
            animation: slideIn 0.2s ease-out;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .cursor-blink {
            animation: blink 1s infinite;
        }
        
        .message-status {
            font-size: 10px;
            margin-left: 4px;
        }
        
        .status-single { color: #8696a0; }
        .status-double { color: #8696a0; }
        .status-read { color: #53bdeb; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="whatsapp-bg flex items-center justify-center">
        <div class="w-full max-w-md mx-4">
            <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                <!-- Session Login View -->
                <div id="sessionLoginView" class="p-8">
                    <div class="text-center mb-8">
                        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-[#00a884] to-[#008069] flex items-center justify-center">
                            <i class="fab fa-whatsapp text-2xl text-white"></i>
                        </div>
                        <h2 class="text-2xl font-light text-gray-800 mb-2">WhatsApp Web</h2>
                        <p class="text-gray-500 text-sm">Login with your session credentials</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                            <input id="usernameInput" type="text" placeholder="Enter username" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#00a884] focus:border-transparent transition-all">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                            <div class="relative">
                                <input id="passwordInput" type="password" placeholder="Enter password" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#00a884] focus:border-transparent transition-all pr-10">
                                <button type="button" onclick="togglePasswordVisibility()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                    <i id="apiKeyIcon" class="far fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-2 mt-2">
                            <input id="rememberMe" type="checkbox" class="w-4 h-4 rounded border-gray-300 text-[#00a884] focus:ring-[#00a884]">
                            <label class="text-sm text-gray-600">Remember me</label>
                        </div>
                    </div>
                    
                    <button onclick="authenticate()" class="w-full bg-[#00a884] hover:bg-[#008069] text-white font-semibold py-3 px-4 rounded-lg transition-colors duration-200 mt-6 flex items-center justify-center gap-2">
                        <i class="fas fa-sign-in-alt"></i>
                        Connect to WhatsApp
                    </button>
                    
                    <div class="mt-6 text-center">
                        <div id="server_status" class="text-xs text-gray-400"></div>
                    </div>
                </div>
                
                <!-- Loading View -->
                <div id="loginLoadingView" class="p-12 text-center hidden">
                    <div class="spinner w-12 h-12 border-4 border-gray-200 border-t-[#00a884] rounded-full animate-spin mx-auto mb-6"></div>
                    <div class="text-gray-800 font-medium mb-2">Connecting...</div>
                    <div class="text-gray-500 text-sm">Initializing WhatsApp session</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main WhatsApp Interface -->
    <div id="whatsappInterface" class="hidden h-screen">
        <div class="flex h-full max-w-[1600px] mx-auto">
            <!-- Left Sidebar - Chats -->
            <div class="w-[400px] border-r border-[#2a3942] flex flex-col bg-[#111b21]">
                <!-- Profile Header -->
                <div class="px-4 py-3 flex items-center justify-between bg-[#202c33]">
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#00a884] to-[#008069] flex items-center justify-center text-white font-semibold cursor-pointer" onclick="toggleProfileMenu()">
                                <span id="profileInitial">W</span>
                            </div>
                            <div id="connectionStatus" class="absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-[#111b21] bg-red-500"></div>
                        </div>
                        <div class="flex-1">
                            <div id="currentUser" class="text-sm font-semibold">WhatsApp</div>
                            <div id="statusText" class="text-xs text-[#8696a0]">connecting...</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="showNewChat()" class="text-[#8696a0] hover:text-[#e9edef] transition-colors">
                            <i class="fas fa-comment-alt text-lg"></i>
                        </button>
                        <button onclick="toggleMoreMenu()" class="text-[#8696a0] hover:text-[#e9edef] transition-colors">
                            <i class="fas fa-ellipsis-v text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Search Bar -->
                <div class="p-3 bg-[#202c33]">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-[#8696a0]"></i>
                        </div>
                        <input type="text" id="searchChats" placeholder="Search or start new chat" class="w-full pl-10 pr-4 py-2 bg-[#111b21] border border-[#2a3942] rounded-lg text-sm text-[#e9edef] placeholder-[#8696a0] focus:outline-none focus:border-[#00a884] focus:ring-1 focus:ring-[#00a884] transition-all">
                    </div>
                </div>
                
                <!-- Chats List -->
                <div id="chatsList" class="flex-1 overflow-y-auto whatsapp-scrollbar">
                    <!-- Chats will be loaded here -->
                </div>
            </div>
            
            <!-- Main Chat Area -->
            <div class="flex-1 flex flex-col">
                <!-- Chat Header -->
                <div id="chatHeader" class="px-4 py-3 flex items-center justify-between border-b border-[#2a3942] bg-[#202c33] hidden">
                    <div class="flex items-center gap-3 flex-1">
                        <div class="relative">
                            <div id="chatAvatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-[#00a884] to-[#008069] flex items-center justify-center text-white font-semibold">
                                <i class="fas fa-user"></i>
                            </div>
                            <div id="chatStatus" class="absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-[#202c33] bg-green-500 hidden"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div id="chatName" class="text-sm font-semibold truncate">Select a chat</div>
                            <div id="chatInfo" class="text-xs text-[#8696a0] truncate">Click on a chat to start messaging</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="searchInChat()" class="text-[#8696a0] hover:text-[#e9edef] transition-colors">
                            <i class="fas fa-search text-lg"></i>
                        </button>
                        <button onclick="toggleChatMenu()" class="text-[#8696a0] hover:text-[#e9edef] transition-colors">
                            <i class="fas fa-ellipsis-v text-lg"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Messages Container -->
                <div id="messagesContainer" class="flex-1 bg-[#0c1317] chat-bg-pattern overflow-y-auto whatsapp-scrollbar">
                    <!-- Welcome Screen -->
                    <div id="welcomeScreen" class="h-full flex flex-col items-center justify-center text-center px-4">
                        <div class="w-32 h-32 rounded-full bg-gradient-to-br from-[#00a884]/10 to-[#008069]/10 flex items-center justify-center mb-6">
                            <i class="fab fa-whatsapp text-6xl text-[#00a884]/30"></i>
                        </div>
                        <h1 class="text-2xl font-light mb-3">WhatsApp Web</h1>
                        <p class="text-[#8696a0] max-w-md mb-8">
                            Send and receive messages without keeping your phone online.<br>
                            Use WhatsApp on up to 4 linked devices and 1 phone at the same time.
                        </p>
                        <div class="border-t border-[#2a3942] pt-8 w-full max-w-sm">
                            <div class="text-sm text-[#8696a0] mb-4">Your conversations are secured with end-to-end encryption</div>
                            <div class="flex items-center justify-center gap-2 text-[#8696a0] text-sm">
                                <i class="fas fa-lock"></i>
                                <span>Your personal messages are protected</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Message Input -->
                <div id="messageInputContainer" class="p-4 border-t border-[#2a3942] bg-[#202c33] hidden">
                    <!-- Reply Preview -->
                    <div id="replyPreview" class="mb-2 bg-[#111b21] border-l-4 border-[#00a884] rounded px-3 py-2 hidden">
                        <div class="flex justify-between items-center">
                            <div class="flex-1 overflow-hidden">
                                <div id="replySender" class="text-xs font-semibold text-[#00a884] mb-0.5"></div>
                                <div id="replyText" class="text-xs text-[#8696a0] truncate"></div>
                            </div>
                            <button onclick="cancelReply()" class="text-[#8696a0] hover:text-[#e9edef] ml-2">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex items-end gap-2">
                        <!-- Attachment Button -->
                        <button onclick="toggleAttachmentMenu()" class="w-10 h-10 rounded-full bg-[#111b21] hover:bg-[#2a3942] flex items-center justify-center text-[#8696a0] hover:text-[#e9edef] transition-colors">
                            <i class="fas fa-plus text-lg"></i>
                        </button>
                        
                        <!-- Emoji Button -->
                        <button onclick="toggleEmojiPicker()" class="w-10 h-10 rounded-full bg-[#111b21] hover:bg-[#2a3942] flex items-center justify-center text-[#8696a0] hover:text-[#e9edef] transition-colors">
                            <i class="far fa-smile text-lg"></i>
                        </button>
                        
                        <!-- Message Input -->
                        <div class="flex-1">
                            <textarea id="messageInput" placeholder="Type a message" rows="1" class="w-full bg-[#111b21] border border-[#2a3942] rounded-lg px-4 py-3 text-[#e9edef] placeholder-[#8696a0] resize-none max-h-32 min-h-[44px] focus:outline-none focus:border-[#00a884] focus:ring-1 focus:ring-[#00a884] transition-all whatsapp-scrollbar"></textarea>
                        </div>
                        
                        <!-- Send Button -->
                        <button id="sendButton" onclick="sendMessage()" class="w-10 h-10 rounded-full bg-[#00a884] hover:bg-[#008069] flex items-center justify-center text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Chat Info -->
            <div id="chatInfoSidebar" class="w-[400px] border-l border-[#2a3942] bg-[#111b21] hidden">
                <!-- Info Header -->
                <div class="p-8 border-b border-[#2a3942]">
                    <div class="text-center">
                        <div class="w-40 h-40 mx-auto mb-4 rounded-full bg-gradient-to-br from-[#00a884] to-[#008069] flex items-center justify-center text-white text-5xl font-semibold">
                            <i class="fas fa-user"></i>
                        </div>
                        <h2 id="infoName" class="text-xl font-semibold mb-2">Chat Info</h2>
                        <div id="infoDescription" class="text-[#8696a0] text-sm">Select a chat to view details</div>
                    </div>
                </div>
                
                <!-- Info Content -->
                <div id="infoContent" class="p-4 overflow-y-auto whatsapp-scrollbar">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modals & Dropdowns -->
    
    <!-- Profile Menu -->
    <div id="profileMenu" class="absolute top-16 left-4 w-64 bg-[#233138] rounded-lg shadow-xl border border-[#2a3942] hidden context-menu-shadow z-50">
        <div class="p-4 border-b border-[#2a3942]">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-[#00a884] to-[#008069] flex items-center justify-center text-white font-semibold">
                    <span id="menuProfileInitial">W</span>
                </div>
                <div>
                    <div id="menuUserName" class="text-sm font-semibold">WhatsApp</div>
                    <div id="menuStatus" class="text-xs text-[#8696a0]">Online</div>
                </div>
            </div>
        </div>
        <div class="py-2">
            <button onclick="openSettings()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-user mr-3 text-[#8696a0]"></i>
                Profile
            </button>
            <button onclick="openStarredMessages()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="far fa-star mr-3 text-[#8696a0]"></i>
                Starred Messages
            </button>
            <button onclick="openSettings()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-cog mr-3 text-[#8696a0]"></i>
                Settings
            </button>
        </div>
        <div class="border-t border-[#2a3942] pt-2">
            <button onclick="logout()" class="w-full px-4 py-3 text-left text-sm text-red-400 hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-sign-out-alt mr-3"></i>
                Log out
            </button>
        </div>
    </div>

    <!-- More Menu -->
    <div id="moreMenu" class="absolute top-16 right-4 w-56 bg-[#233138] rounded-lg shadow-xl border border-[#2a3942] hidden context-menu-shadow z-50">
        <div class="py-2">
            <button onclick="openNewGroup()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-users mr-3 text-[#8696a0]"></i>
                New group
            </button>
            <button onclick="openNewBroadcast()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-bullhorn mr-3 text-[#8696a0]"></i>
                New broadcast
            </button>
            <button onclick="openLinkedDevices()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-link mr-3 text-[#8696a0]"></i>
                Linked devices
            </button>
            <button onclick="openStarredMessages()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="far fa-star mr-3 text-[#8696a0]"></i>
                Starred messages
            </button>
        </div>
        <div class="border-t border-[#2a3942] pt-2">
            <button onclick="openSettings()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-cog mr-3 text-[#8696a0]"></i>
                Settings
            </button>
            <button onclick="logout()" class="w-full px-4 py-3 text-left text-sm text-red-400 hover:bg-[#2a3942] transition-colors">
                <i class="fas fa-sign-out-alt mr-3"></i>
                Log out
            </button>
        </div>
    </div>

    <!-- New Chat Modal -->
    <div id="newChatModal" class="fixed inset-0 modal-overlay-bg flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 overflow-hidden">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-800">New chat</h3>
                    <button onclick="closeNewChatModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-4">
                <div class="relative mb-4">
                    <div class="absolute inset-y-0 left-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="searchContacts" placeholder="Search contacts" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00a884] focus:border-transparent">
                </div>
                
                <div id="contactsList" class="max-h-96 overflow-y-auto">
                    <!-- Contacts will be loaded here -->
                </div>
                
                <div class="mt-4">
                    <div class="text-sm font-medium text-gray-700 mb-2">Or start a chat with a new contact</div>
                    <input type="text" id="newContactNumber" placeholder="Phone number (e.g., 628123456789)" class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#00a884] focus:border-transparent">
                    <button onclick="startNewChatWithNumber()" class="w-full mt-3 bg-[#00a884] hover:bg-[#008069] text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                        Start Chat
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Emoji Picker -->
    <div id="emojiPicker" class="absolute bottom-20 left-4 w-72 bg-[#233138] border border-[#2a3942] rounded-lg shadow-xl p-4 hidden z-40">
        <div class="emoji-grid">
            <!-- Emojis will be loaded here -->
        </div>
    </div>

    <!-- Attachment Menu -->
    <div id="attachmentMenu" class="absolute bottom-20 left-4 w-56 bg-[#233138] border border-[#2a3942] rounded-lg shadow-xl py-2 hidden z-40 context-menu-shadow">
        <button onclick="sendPhoto()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-image mr-3 text-[#8696a0]"></i>
            Photos & Videos
        </button>
        <button onclick="sendDocument()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-file mr-3 text-[#8696a0]"></i>
            Document
        </button>
        <button onclick="sendAudio()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-microphone mr-3 text-[#8696a0]"></i>
            Audio
        </button>
        <button onclick="sendContact()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-user mr-3 text-[#8696a0]"></i>
            Contact
        </button>
        <button onclick="sendLocation()" class="w-full px-4 py-3 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-map-marker-alt mr-3 text-[#8696a0]"></i>
            Location
        </button>
    </div>

    <!-- Message Context Menu -->
    <div id="messageContextMenu" class="absolute bg-[#233138] border border-[#2a3942] rounded-lg shadow-xl py-2 hidden z-50 context-menu-shadow">
        <button onclick="replyToMessage()" class="w-full px-4 py-2 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-reply mr-3 text-[#8696a0]"></i>
            Reply
        </button>
        <button onclick="forwardMessage()" class="w-full px-4 py-2 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-share mr-3 text-[#8696a0]"></i>
            Forward
        </button>
        <button onclick="copyMessage()" class="w-full px-4 py-2 text-left text-sm text-[#e9edef] hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-copy mr-3 text-[#8696a0]"></i>
            Copy
        </button>
        <div class="border-t border-[#2a3942] my-1"></div>
        <button onclick="deleteMessage()" class="w-full px-4 py-2 text-left text-sm text-red-400 hover:bg-[#2a3942] transition-colors">
            <i class="fas fa-trash mr-3"></i>
            Delete
        </button>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-[#111b21] bg-opacity-90 flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <div class="spinner w-16 h-16 border-4 border-[#2a3942] border-t-[#00a884] rounded-full animate-spin mx-auto mb-6"></div>
            <div class="text-[#e9edef] font-medium">Connecting to WhatsApp...</div>
        </div>
    </div>

    <script>

        let API_BASE = '/api/whatsapp';
        let WS_URL = window.location.origin;
        let isAuthenticated = false;
        
        const elements = {
            status: document.getElementById('server_status'),
            username: document.getElementById('usernameInput'),
            password: document.getElementById('passwordInput'),
            rememberMe: document.getElementById('rememberMe'),
        }
        
        async function apiFetch(url, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            options.headers = headers;
            
            try {
                const response = await fetch(url, options);
                return response;
            } catch (error) {
                console.error('API fetch error:', error);
                throw error;
            }
        }

        
        async function loadStatus() {
            try {
                const response = await fetch('/api/health', {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
        
                if (!response.ok) {
                    elements.status.textContent = "üî¥ Server Offline";
                    return;
                }
        
                const data = await response.json();
        
                if (data.success) {
                    elements.status.textContent = "üü¢ Server Online";
                } else {
                    elements.status.textContent = "üî¥ Server Offline";
                }
        
            } catch (error) {
                elements.status.textContent = "üî¥ Server Offline";
            }
        }

        function checkAuth() {
            const authToken = sessionStorage.getItem('dashboard_auth');
            const storedApiKey = sessionStorage.getItem('api_key');
            if (authToken === 'authenticated') {
                isAuthenticated = true;
                if (storedApiKey) {
                    apiKey = storedApiKey;
                }
                return true;
            }
            return false;
        }
        
        // State management
        let state = {
            currentSession: null,
            currentChat: null,
            chats: [],
            messages: new Map(),
            contacts: [],
            groups: [],
            typingUsers: new Map(),
            socket: null,
            apiKey: '',
            emojis: ['üòÄ', 'üòÇ', 'ü•∞', 'üòé', 'ü§î', 'üò¢', 'üëç', '‚ù§Ô∏è', 'üî•', '‚ú®', 'üéâ', 'üíØ', 'üëã', 'ü§ù', 'üí™', 'üôè', 'üëè', 'üé∂', 'üì∑', 'üìç', 'üì±', 'üíª', 'üéÆ', 'üçï', '‚òï', 'üéÇ', 'üåà', '‚≠ê', 'üåü', '‚ö°', 'üí•', 'üí´', 'üí®', 'üí¶', 'üí¨', 'üëÄ', 'üëÅÔ∏è', 'üß†', 'ü´Ä', 'ü¶∑', 'ü¶¥', 'üëÉ', 'üëÇ', 'üëÖ', 'üëÑ', 'üíã', 'üíÖ', 'üë£', 'üëÅÔ∏è‚Äçüó®Ô∏è', 'üó®Ô∏è', 'üóØÔ∏è', 'üí≠', 'üí§', 'üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'üëå', 'ü§å', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', '‚òùÔ∏è', 'üëç', 'üëé', '‚úä', 'üëä', 'ü§õ', 'ü§ú', 'üëè', 'üôå', 'üëê', 'ü§≤', 'ü§ù', 'üôè', '‚úçÔ∏è', 'üíÖ', 'ü§≥', 'üí™', 'ü¶æ', 'ü¶ø', 'ü¶µ', 'ü¶∂', 'üëÇ', 'ü¶ª', 'üëÉ', 'üß†', 'ü´Ä', 'ü´Å', 'ü¶∑', 'ü¶¥', 'üëÄ', 'üëÅÔ∏è', 'üëÖ', 'üëÑ', 'üíã', 'üë∂', 'üßí', 'üë¶', 'üëß', 'üßë', 'üë±', 'üë®', 'üßî', 'üë®‚Äçü¶∞', 'üë®‚Äçü¶±', 'üë®‚Äçü¶≥', 'üë®‚Äçü¶≤', 'üë©', 'üë©‚Äçü¶∞', 'üë©‚Äçü¶±', 'üë©‚Äçü¶≥', 'üë©‚Äçü¶≤', 'üßì', 'üë¥', 'üëµ', 'üôç', 'üôé', 'üôÖ', 'üôÜ', 'üíÅ', 'üôã', 'üßè', 'üôá', 'ü§¶', 'ü§∑', 'üëÆ', 'üïµÔ∏è', 'üíÇ', 'üë∑', 'ü§¥', 'üë∏', 'üë≥', 'üë≤', 'üßï', 'ü§µ', 'üë∞', 'ü§∞', 'ü§±', 'üëº', 'üéÖ', 'ü§∂', 'ü¶∏', 'ü¶π', 'üßô', 'üßö', 'üßõ', 'üßú', 'üßù', 'üßû', 'üßü', 'üíÜ', 'üíá', 'üö∂', 'üßç', 'üßé', 'üèÉ', 'üíÉ', 'üï∫', 'üëØ', 'üßñ', 'üßó', 'ü§∫', 'üèá', '‚õ∑Ô∏è', 'üèÇ', 'üèåÔ∏è', 'üèÑ', 'üö£', 'üèä', '‚õπÔ∏è', 'üèãÔ∏è', 'üö¥', 'üöµ', 'ü§∏', 'ü§º', 'ü§Ω', 'ü§æ', 'ü§π', 'üßò', 'üõÄ', 'üõå', 'üë≠', 'üë´', 'üë¨', 'üíè', 'üíë', 'üë™', 'üó£Ô∏è', 'üë§', 'üë•'],
            messageStatus: new Map(), // Store message status updates
            presenceStatus: new Map() // Store user presence status
        };
        
        document.addEventListener('DOMContentLoaded', async () => {
            const savedSession = localStorage.getItem('whatsapp_session');
            
            if (savedSession) {

            } else {
                await loadStatus();
            }
        });
        
        const authenticate = async () => {
            const username = elements.username.value.trim(); 
            const password = elements.password.value.trim();  
            const rememberMe = elements.rememberMe.checked;
            
            if (!username || !password) {
                showToast('Please enter user name and password', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    apiKey = data.key;
                    sessionStorage.setItem('whatsapp_session', apiKey);
                    return true;
                } else {
                    console.log('‚ùå ' + data.message);
                }
            } catch (error) {
                console.log('‚ùå Login failed: ' + error.message);
            }
            
        }

        function togglePasswordVisibility() {
            const input = document.getElementById('passwordInput');
            const icon = document.getElementById('apiKeyIcon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'far fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'far fa-eye';
            }
        }        

    </script>
</body>
</html>